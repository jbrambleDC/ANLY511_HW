create table tt_usage_by_zip as (select c.id as customer_id ,cc.mail_postal_code as zip_code ,sp.meter_type as meter_type, c.customer_type as customer_type, AVG(ur.usage_value)/stp.living_sqft as avg_usage from customer c join customer_contact cc on c.id = cc.customer_id join utility_acct ua on c.id =  ua.customer_id join service_point sp on sp.id = ua.service_point_id join usage_read ur on ur.service_point_id = sp.id join site_parcel stp on sp.site_id = stp.site_id where ua.inactive_date is null and ur.to_date >= '2015-01-01' and stp.living_sqft is not null group by c.id);
select avg(avg_usage), zip_code, meter_type,_customer_type from tt_usage_by_zip group by 2,3,4;
